<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INTUITY - Essay Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --gold: #d4af37;
            --gold-light: #f4e5b8;
            --blue: #2196f3;
            --green: #4CAF50;
            --red: #f44336;
            --purple: #9c27b0;
            --bg-dark: #1a1a1a;
            --bg-card: #2a2a2a;
            --text-light: #e0e0e0;
            --text-muted: #8e8e93;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: var(--text-light);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* SIGNATURE HEADER */
        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        .header .subtitle {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 5px;
            font-weight: 500;
            letter-spacing: 0.1em;
        }

        .header .author {
            font-size: 0.85rem;
            color: var(--gold);
            font-weight: 600;
            margin-bottom: 3px;
        }

        .header .product {
            font-size: 1.1rem;
            color: var(--text-light);
            font-weight: 600;
            letter-spacing: 0.05em;
        }

        /* CONTROL BAR */
        .control-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .mode-toggle {
            display: flex;
            gap: 8px;
            background: var(--bg-card);
            padding: 6px;
            border-radius: 10px;
            border: 2px solid rgba(212, 175, 55, 0.3);
        }

        .mode-btn {
            padding: 10px 20px;
            background: transparent;
            border: none;
            color: var(--text-light);
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .mode-btn.active {
            background: var(--gold);
            color: #1a1a1a;
        }

        .topics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin-bottom: 30px;
        }

        .topic-btn {
            padding: 14px;
            background: var(--bg-card);
            border: 2px solid rgba(212, 175, 55, 0.3);
            color: var(--text-light);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .topic-btn:hover {
            border-color: var(--gold);
            transform: translateY(-2px);
        }

        .topic-btn.active {
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
            color: #1a1a1a;
        }

        .composer {
            background: var(--bg-card);
            border-radius: 15px;
            padding: 30px;
            border: 1px solid rgba(212, 175, 55, 0.2);
        }

        .section {
            margin-bottom: 35px;
            padding: 25px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            border-left: 4px solid var(--blue);
        }

        .section.intro { border-left-color: var(--gold); }
        .section.counter { border-left-color: var(--red); }
        .section.conclusion { border-left-color: var(--purple); }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(212, 175, 55, 0.2);
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--gold);
        }

        .word-target {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .guide-btn {
            padding: 8px 15px;
            background: rgba(33, 150, 243, 0.2);
            border: 1px solid var(--blue);
            color: var(--blue);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .guide-btn:hover {
            background: rgba(33, 150, 243, 0.3);
        }

        .dropdowns-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .dropdown-btn {
            padding: 8px 14px;
            background: rgba(33, 150, 243, 0.15);
            border: 1px solid rgba(33, 150, 243, 0.4);
            color: var(--blue);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
            transition: all 0.3s ease;
        }

        .dropdown-btn:hover {
            background: rgba(33, 150, 243, 0.25);
            transform: translateY(-2px);
        }

        .dropdown-btn.active {
            background: var(--blue);
            color: white;
        }

        /* IDEAS BUTTON - Special styling */
        .dropdown-btn.ideas-btn {
            background: rgba(255, 215, 0, 0.15);
            border-color: rgba(255, 215, 0, 0.5);
            color: var(--gold);
            font-weight: 700;
        }

        .dropdown-btn.ideas-btn:hover {
            background: rgba(255, 215, 0, 0.25);
        }

        .dropdown-btn.ideas-btn.active {
            background: var(--gold);
            color: #1a1a1a;
        }

        .dropdown-panel {
            display: none;
            margin-bottom: 15px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 8px;
            border: 1px solid rgba(33, 150, 243, 0.3);
            overflow: hidden;
        }

        .dropdown-panel.active {
            display: block;
            animation: slideDown 0.3s ease;
        }

        /* IDEAS PANEL - Special styling */
        .dropdown-panel.ideas-panel {
            border-color: rgba(212, 175, 55, 0.5);
            background: rgba(212, 175, 55, 0.05);
        }

        .ideas-content {
            padding: 20px;
        }

        .idea-section {
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            border-left: 3px solid var(--gold);
        }

        .idea-label {
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--gold);
            margin-bottom: 8px;
            letter-spacing: 1px;
        }

        .idea-text {
            font-size: 0.95rem;
            line-height: 1.6;
            color: var(--text-light);
        }

        .idea-list {
            list-style: none;
            padding-left: 0;
        }

        .idea-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
        }

        .idea-list li:before {
            content: "‚Ä¢";
            position: absolute;
            left: 0;
            color: var(--gold);
            font-weight: bold;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .level {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .level:last-child {
            border-bottom: none;
        }

        .level-header {
            padding: 12px 15px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .level.natural .level-header {
            background: rgba(244, 67, 54, 0.15);
            color: #ff6b6b;
        }

        .level.intermediate .level-header {
            background: rgba(255, 152, 0, 0.15);
            color: #ffa726;
        }

        .level.academic .level-header {
            background: rgba(76, 175, 80, 0.15);
            color: #66bb6a;
        }

        .level-content {
            max-height: 200px;
            overflow-y: auto;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
        }

        .level.natural .level-content {
            background: rgba(244, 67, 54, 0.05);
        }

        .level.intermediate .level-content {
            background: rgba(255, 152, 0, 0.05);
        }

        .level.academic .level-content {
            background: rgba(76, 175, 80, 0.05);
        }

        .phrase-item {
            padding: 8px 0;
            font-size: 0.9rem;
            line-height: 1.6;
            color: var(--text-light);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .phrase-item:last-child {
            border-bottom: none;
        }

        .phrase-item:before {
            content: "‚Ä¢ ";
            color: var(--gold);
            font-weight: bold;
            margin-right: 8px;
        }

        .level-why {
            font-size: 0.75rem;
            opacity: 0.7;
            padding: 10px 15px;
            background: rgba(0, 0, 0, 0.2);
            font-style: italic;
        }

        .paragraph-input {
            width: 100%;
            padding: 15px;
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(212, 175, 55, 0.3);
            border-radius: 10px;
            color: var(--text-light);
            font-family: inherit;
            font-size: 1rem;
            line-height: 1.7;
            resize: vertical;
            min-height: 120px;
            transition: all 0.3s ease;
        }

        .paragraph-input:focus {
            outline: none;
            border-color: var(--gold);
            background: rgba(0, 0, 0, 0.6);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.2);
        }

        .paragraph-input.saved {
            border-color: var(--green);
            animation: saveFlash 0.5s ease;
        }

        @keyframes saveFlash {
            0%, 100% { border-color: rgba(212, 175, 55, 0.3); }
            50% { border-color: var(--green); }
        }

        .paragraph-mode .section {
            display: none;
        }

        .paragraph-mode .section.active {
            display: block;
        }

        .para-nav {
            display: none;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }

        .paragraph-mode .para-nav {
            display: flex;
        }

        .nav-btn {
            padding: 10px 20px;
            background: var(--gold);
            color: #1a1a1a;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .nav-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.3);
        }

        .nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .para-indicator {
            font-weight: 700;
            color: var(--gold);
        }

        .preview-popup {
            position: fixed;
            top: 100px;
            right: 30px;
            width: 380px;
            max-height: 80vh;
            background: var(--bg-card);
            border: 2px solid var(--gold);
            border-radius: 15px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.7);
            z-index: 1000;
            overflow: hidden;
        }

        .preview-header {
            padding: 15px;
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
            color: #1a1a1a;
            cursor: move;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
        }

        .preview-title {
            font-weight: 700;
            font-size: 1rem;
        }

        .preview-body {
            padding: 20px;
            max-height: calc(80vh - 200px);
            overflow-y: auto;
        }

        .preview-paragraph {
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border-left: 3px solid var(--gold);
            font-size: 0.9rem;
            line-height: 1.7;
        }

        .preview-section-label {
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .preview-empty {
            color: var(--text-muted);
            font-style: italic;
            text-align: center;
            padding: 30px;
        }

        .register-section {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 8px;
        }

        .register-title {
            font-size: 0.8rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--text-muted);
        }

        .meter-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .meter-fill {
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 4px;
            background: #4CAF50;
        }

        .word-count-display {
            margin-top: 12px;
            padding: 10px;
            background: rgba(76, 175, 80, 0.1);
            border-left: 3px solid var(--green);
            border-radius: 6px;
            font-size: 0.85rem;
        }

        .word-count-display.warning {
            background: rgba(255, 152, 0, 0.1);
            border-left-color: #ff9800;
        }

        .word-count-display.error {
            background: rgba(244, 67, 54, 0.1);
            border-left-color: #f44336;
        }

        .guide-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            padding: 20px;
            overflow-y: auto;
        }

        .guide-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .guide-content {
            background: var(--bg-card);
            border: 2px solid var(--gold);
            border-radius: 15px;
            padding: 30px;
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .guide-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--gold);
        }

        .guide-header h2 {
            color: var(--gold);
            font-size: 1.5rem;
        }

        .close-guide {
            background: var(--red);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .guide-section {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border-left: 3px solid var(--blue);
        }

        .guide-section h3 {
            color: var(--gold);
            margin-bottom: 12px;
        }

        .guide-section ul {
            list-style-position: inside;
            line-height: 1.8;
        }

        .actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-top: 30px;
        }

        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            background: var(--gold);
            color: #1a1a1a;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.3);
        }

        @media (max-width: 768px) {
            .preview-popup {
                position: fixed;
                top: auto;
                bottom: 0;
                left: 0;
                right: 0;
                width: 100%;
                max-height: 50vh;
                border-radius: 15px 15px 0 0;
            }

            .dropdowns-row {
                gap: 8px;
            }

            .dropdown-btn {
                font-size: 0.75rem;
                padding: 6px 10px;
            }
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gold);
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- SIGNATURE HEADER -->
        <div class="header">
            <h1>INTUITY</h1>
            <p class="subtitle">Intuitive & Immersive</p>
            <p class="author">Majid Nashtai</p>
            <p class="product">Essay Generator</p>
        </div>

        <div class="control-bar">
            <div class="topics" id="topics"></div>
            <div class="mode-toggle">
                <button class="mode-btn active" onclick="setMode('full')">üìÑ Full</button>
                <button class="mode-btn" onclick="setMode('paragraph')">üìã Para</button>
            </div>
        </div>

        <div class="para-nav">
            <button class="nav-btn" id="prevBtn" onclick="navigateSection(-1)">‚Üê Previous</button>
            <span class="para-indicator" id="paraIndicator">Introduction (1/5)</span>
            <button class="nav-btn" id="nextBtn" onclick="navigateSection(1)">Next ‚Üí</button>
        </div>

        <div class="composer" id="composer"></div>

        <div class="actions">
            <button class="btn" onclick="saveDraft()">üíæ Save</button>
            <button class="btn" onclick="loadDraft()">üìÇ Load</button>
            <button class="btn" onclick="resetAll()">üîÑ Reset</button>
            <button class="btn" onclick="exportEssay()">üì• Export</button>
        </div>
    </div>

    <div class="preview-popup" id="previewPopup">
        <div class="preview-header" id="previewHeader">
            <span class="preview-title">üìÑ Your Essay</span>
        </div>
        <div class="preview-body" id="previewBody">
            <div class="preview-empty">Start writing to see your essay build here...</div>
            <div class="register-section">
                <div class="register-title">üéØ REGISTER ANALYSIS</div>
                <div class="meter-bar">
                    <div class="meter-fill" id="registerBar" style="width: 0%"></div>
                </div>
                <div class="word-count-display" id="wordCount">Words: 0 / 190 target</div>
            </div>
        </div>
    </div>

    <div class="guide-overlay" id="guideOverlay">
        <div class="guide-content">
            <div class="guide-header">
                <h2>üìò Essay Structure Guide</h2>
                <button class="close-guide" onclick="closeGuide()">√ó</button>
            </div>
            <div class="guide-section">
                <h3>INTRODUCTION (35-40 words)</h3>
                <ul>
                    <li>Background information</li>
                    <li>Essay aim</li>
                </ul>
            </div>
            <div class="guide-section">
                <h3>CLAIMS 1-3 (50-55 words each)</h3>
                <ul>
                    <li>8 fields: Listing, Opinion, Claim, Reason, Example, Result, Compare, Contrast</li>
                </ul>
            </div>
            <div class="guide-section">
                <h3>CONCLUSION (30-35 words)</h3>
                <ul>
                    <li>Conclusion phrase, Opinion, Final thought</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        const phraseBank = {
            background: {
                natural: ['Nowadays', 'Today', 'These days', 'We can all accept the fact that', 'It is often argued that', 'It is generally assumed that', 'There is a growing recognition that', 'It is common knowledge that', 'Over the past few years', 'Recent studies show that', 'Few people would deny that', 'It has always played a significant role'],
                intermediate: ['In recent years we have seen a notable', 'We have seen a considerable', 'We are observing a trend with regard to', 'There has been a steady/gradual shift in', 'There has been a noticeable change towards/in', 'There has been a marked increase in', 'is commonly viewed as increasingly', 'is broadly seen as', 'More and more', 'has a reputation for', 'is quite often perceived as', 'is widely regarded as'],
                academic: ['Over the past decade, there has been a significant increase in', 'Contemporary research suggests that', 'It is widely recognized/believed that', 'There is indisputable perception that', 'Critics often maintain/contend that', 'There has been considerable criticism regarding', 'There is a broad generalization that', 'There is no shortage enough evidence to indicate that', 'It has always played a significant role in our lives', 'have indisputably become inseparable from', 'Recent studies show that', 'There has been a significant increase']
            },
            aim: {
                natural: ["So we should look at", "Let's talk about", 'This essay is about', 'We need to think about'],
                intermediate: ['Therefore it is important', 'Hence we should consider', 'This essay will examine', 'It is vital to analyze', 'Consequently, it is essential that we study', 'Therefore, it is vital that we analyze the pros and cons of', 'it is important to express our views regarding', 'it is important to discuss whether'],
                academic: ['Thus this essay seeks to analyze', 'Consequently this discourse will evaluate', 'This examination will critically assess', 'Therefore, we should find ways in which we can address/deal with/tackle this problem/issue', 'Consequently, all steps must be taken to tackle/deal with/address this', 'Hence, how can we deal with/tackle this problem?', 'Therefore, it is imperatives to discuss the causes/the impact of', 'Hence, we need to understand what causes/ impacts', 'What are the real causes of...? What are the reasons behind..?']
            },
            listing: {
                natural: ['First', 'To begin with', 'First of all', 'In the first place', 'For one thing', 'Second', 'Secondly', 'Apart from that', 'Moreover', 'Furthermore', 'Third', 'Thirdly', 'In addition', 'Besides', 'Apart from...ing', 'Also', 'On the other hand', 'However'],
                intermediate: ['Firstly', 'Secondly', 'Moreover', 'Furthermore', 'In addition', 'However', 'On the contrary', 'Nevertheless'],
                academic: ['To begin with', 'Moreover', 'Furthermore', 'On the other hand', 'Conversely', 'Notwithstanding']
            },
            opinion: {
                natural: ['I think', 'I believe', 'In my opinion', 'It is my sincere belief that', 'It seems to me', 'It is beyond doubt that', 'From my point of view', 'as far as I can judge', 'It is important to acknowledge'],
                intermediate: ['It seems to me', 'It appears that', 'I would argue', 'It is often maintained that', 'It is often argued that', 'It is commonly known that', 'It is widely held that', 'It is commonly/widely believed that', 'It is generally thought that', 'It is often assumed/maintained that', 'It is widely held that'],
                academic: ['As far as I can judge', 'It is reasonable to suggest', 'From an analytical standpoint', 'It is often maintained/contended that', 'There is widespread perception that', 'Many/Some experts seem to think that', 'There is widespread perception that', 'Critics often maintain/contend that', 'It is likely that', 'One other possibility is that', 'In all likelihood', 'There is every reason that']
            },
            claim: {
                natural: ['the good thing is', 'the benefit is', 'one advantage is', 'the main advantage of', 'the main argument in favour', 'one positive aspect of'],
                intermediate: ['the main advantage is that', 'one positive aspect is', 'a key benefit is', 'the main argument in favour is that', 'A striking/useful/remarkable feature of'],
                academic: ['the primary advantage is that', 'a significant benefit lies in', 'the fundamental strength is', 'The argument in favour of...is that', 'What sets...apart is its extraordinary', 'The real value of...lies in', 'A significant strength of...is that', 'the obvious drawback is that', 'the argument against']
            },
            reason: {
                natural: ['because', 'because they help people', 'since they', 'the', 'This is largely due to/owing to the fact that', 'given that', 'taking into account that', 'One explanation is that'],
                intermediate: ['because platforms provide', 'due to the fact that', 'since systems enable', 'This is largely because', 'This is largely due to', 'owing to'],
                academic: ['because platforms systematically facilitate', 'owing to the comprehensive nature of', 'this is largely attributable to', 'It is vitally important that we...', 'one effective way to deal with this', 'one effective way to tackle', 'one clear solution would be', 'For the best way to tackle', 'The argument against...is that']
            },
            example: {
                natural: ['For example', 'Like when', 'Such as', 'for instance', 'for example', 'In particular', 'particularly', 'especially', 'in particular', 'like', 'In other words', 'that is to say'],
                intermediate: ['For instance', 'To illustrate', 'As demonstrated by', 'To illustrate this'],
                academic: ['To exemplify this', 'This is particularly evident in', 'A salient example is', 'In order to/so as to/with the aim of']
            },
            result: {
                natural: ['So', "That's why", 'This means', 'As a result', 'Therefore', 'Hence', 'Consequently', 'Yet/still'],
                intermediate: ['Therefore', 'Consequently', 'As a result', 'Thus', 'Hence'],
                academic: ['Thus', 'Hence', 'This consequently facilitates', 'This subsequently enables', 'Accordingly']
            },
            compare: {
                natural: ['Like', 'Same as', 'Also', 'like/unlike', 'compared to', 'in comparison with', 'while/whereas'],
                intermediate: ['Similarly', 'Likewise', 'In the same way', 'By comparison'],
                academic: ['Analogously', 'Correspondingly', 'By the same token', 'Comparatively speaking']
            },
            contrast: {
                natural: ['But', 'However', 'Even though', 'although/even though', 'despite/in spite of'],
                intermediate: ['Nevertheless', 'On the contrary', 'Although', 'Despite this', 'In contrast'],
                academic: ['Notwithstanding', 'Conversely', 'Despite this consideration', 'Nonetheless', 'Regardless of its limitations']
            },
            conclusion: {
                natural: ['In the end', 'To finish', 'So overall', 'All things considered', 'All in all', 'In conclusion', 'To sum up'],
                intermediate: ['In conclusion', 'To summarize', 'Overall', 'All things considered', 'To sum up', 'On balance'],
                academic: ['In summation', 'To encapsulate the discourse', 'Upon comprehensive analysis', 'All things considered', 'All in all, in conclusion']
            },
            finalThought: {
                natural: ['I think we should', 'Maybe we can', 'People need to', 'as far as I can judge', 'despite some of the views expressed', 'it is clear that', 'it seems to me', 'despite some of the arguments', 'it is felt that'],
                intermediate: ['It would be beneficial', 'We should consider', 'It is important', 'as far as I\'m concerned', 'even though there are concerns about', 'despite some of the views expressed', 'it is clear that'],
                academic: ['It is imperative that stakeholders', 'Future discourse should prioritize', 'Sustained engagement necessitates', 'As far as I can judge, despite some of the views expressed', 'it is clear that', 'It seems to me, despite some of the arguments', 'it is felt that the benefits of...are enormous', 'as far as I\'m concerned, even though there are concerns']
            }
        };

        const topicIdeas = {
            social: {
                intro: {
                    mainIdea: 'Social media platforms have transformed how we communicate globally',
                    points: ['Platforms are integral to daily life', 'They offer unprecedented connectivity', 'Privacy concerns are growing', 'Need balanced perspective on benefits and risks']
                },
                claim1: {
                    mainArgument: 'Social media enables instant global communication',
                    reason: 'Platforms provide real-time interaction tools',
                    example: 'Families separated by distance maintain close relationships through video calls',
                    result: 'Geographical barriers no longer prevent meaningful connections'
                },
                claim2: {
                    mainArgument: 'These platforms provide valuable professional networking opportunities',
                    reason: 'Connect with colleagues and potential employers worldwide',
                    example: 'Professionals expand career prospects significantly',
                    result: 'Instant access to global markets unlike traditional networking'
                },
                claim3: {
                    mainArgument: 'Privacy concerns remain serious (COUNTER-ARGUMENT)',
                    reason: 'Platforms collect personal data',
                    example: 'Information is often sold to advertisers without explicit consent',
                    contrast: 'Although problematic, benefits outweigh these concerns'
                },
                conclusion: {
                    summary: 'Social media offers both significant benefits and substantial risks',
                    finalView: 'Key lies in mindful usage and digital literacy education'
                }
            },
            shopping: {
                intro: {
                    mainIdea: 'E-commerce has revolutionized retail practices globally',
                    points: ['Online shopping has increased significantly', 'Revolutionized retail landscape', 'Traditional stores offer unique advantages', 'Important to consider both sides']
                },
                claim1: {
                    mainArgument: 'Online shopping offers unparalleled convenience',
                    reason: 'Digital platforms eliminate travel time',
                    example: 'Consumers browse and purchase products 24/7 from home',
                    result: 'Shopping becomes effortless'
                },
                claim2: {
                    mainArgument: 'Platforms provide access to wider product ranges',
                    reason: 'Global marketplace integration',
                    example: 'Shoppers compare prices across multiple retailers instantly',
                    result: 'Unlike physical stores, online platforms offer unlimited inventory'
                },
                claim3: {
                    mainArgument: 'E-commerce contributes to environmental concerns (COUNTER)',
                    reason: 'Excessive packaging and delivery emissions',
                    example: 'Each individual delivery increases carbon footprint',
                    contrast: 'Although concerning, sustainable options are emerging'
                },
                conclusion: {
                    summary: 'Online shopping presents remarkable convenience and notable challenges',
                    finalView: 'Benefits outweigh drawbacks when practiced responsibly'
                }
            },
            travel: {
                intro: {
                    mainIdea: 'International travel broadens perspectives and enriches lives',
                    points: ['Travelling broadens the mind', 'Enriches life experiences', 'Educational benefits despite environmental costs', 'Essential to study both perspectives']
                },
                claim1: {
                    mainArgument: 'Travelling exposes people to diverse cultures and perspectives',
                    reason: 'Direct cultural immersion breaks down stereotypes',
                    example: 'Experiencing different traditions firsthand fosters greater understanding',
                    result: 'Tolerance increases significantly'
                },
                claim2: {
                    mainArgument: 'Exploring new destinations enhances personal growth',
                    reason: 'Navigating unfamiliar environments independently',
                    example: 'Travelers build confidence and problem-solving skills',
                    result: 'Unlike staying home, travel pushes comfort zone boundaries'
                },
                claim3: {
                    mainArgument: 'Air travel contributes to climate change (COUNTER)',
                    reason: 'Substantial carbon emissions from aviation',
                    example: 'Single flights produce significant environmental impact',
                    contrast: 'Although concerning, sustainable tourism practices are emerging'
                },
                conclusion: {
                    summary: 'Travelling offers invaluable experiences alongside environmental responsibilities',
                    finalView: 'Embrace responsible travel balancing enrichment with ecological preservation'
                }
            },
            cities: {
                intro: {
                    mainIdea: 'Urban migration continues accelerating globally',
                    points: ['Cities offer abundant opportunities', 'Also present unique challenges', 'Important to address this issue']
                },
                claim1: {
                    mainArgument: 'City living provides access to superior career opportunities',
                    reason: 'Major corporations concentrate in urban centers',
                    example: 'Professionals earn higher salaries and gain valuable experience',
                    result: 'Unlike rural areas, cities offer diverse job markets'
                },
                claim2: {
                    mainArgument: 'Urban environments offer extensive cultural amenities',
                    reason: 'Cities concentrate resources and populations',
                    example: 'Residents enjoy museums, theaters, diverse restaurants',
                    result: 'Quality of life improves through cultural richness'
                },
                claim3: {
                    mainArgument: 'Urban living involves exorbitant costs (COUNTER)',
                    reason: 'High demand for limited housing',
                    example: 'Rent consumes significant portions of salaries',
                    contrast: 'Although concerning, cities continue attracting people'
                },
                conclusion: {
                    summary: 'City life presents opportunities and challenges',
                    finalView: 'Urban centers will continue attracting people seeking advancement'
                }
            },
            english: {
                intro: {
                    mainIdea: 'English has become the global lingua franca',
                    points: ['Communication across cultures is essential', 'Despite debates about linguistic diversity', 'Important to discuss its impact']
                },
                claim1: {
                    mainArgument: 'Learning English opens doors to international career opportunities',
                    reason: 'English dominates business communication worldwide',
                    example: 'Multinational companies require English proficiency',
                    result: 'Job prospects expand globally'
                },
                claim2: {
                    mainArgument: 'English fluency grants access to vast educational resources',
                    reason: 'Most academic research is published in English',
                    example: 'Online courses predominantly use English',
                    result: 'Learners access cutting-edge knowledge'
                },
                claim3: {
                    mainArgument: 'May threaten linguistic diversity (COUNTER)',
                    reason: 'Diminishing use of minority languages',
                    example: 'Students without English access face limited opportunities',
                    contrast: 'Although important, multilingualism should be promoted'
                },
                conclusion: {
                    summary: 'Learning English provides significant practical advantages',
                    finalView: 'English proficiency should be pursued alongside preserving native languages'
                }
            },
            diet: {
                intro: {
                    mainIdea: 'Maintaining a healthy diet is crucial for wellbeing',
                    points: ['Nutrition directly impacts health', 'Modern lifestyles make healthy eating challenging', 'How can we tackle this problem?']
                },
                claim1: {
                    mainArgument: 'Eating healthily prevents chronic diseases',
                    reason: 'Proper nutrition strengthens immune systems',
                    example: 'Diets rich in vegetables significantly reduce health risks',
                    result: 'Medical costs decrease substantially'
                },
                claim2: {
                    mainArgument: 'Proper nutrition enhances energy levels',
                    reason: 'Balanced meals stabilize blood sugar',
                    example: 'People experience improved concentration and productivity',
                    result: 'Both mental and physical performance improve'
                },
                claim3: {
                    mainArgument: 'Healthy eating can be expensive and time-consuming (COUNTER)',
                    reason: 'Higher costs of fresh produce',
                    example: 'Organic foods cost significantly more',
                    contrast: 'Although challenging, government subsidies could help'
                },
                conclusion: {
                    summary: 'Maintaining a healthy diet offers profound benefits despite challenges',
                    finalView: 'Society should prioritize nutrition education and food accessibility'
                }
            }
        };

        const topics = [
            { id: 'social', name: 'Social Media' },
            { id: 'shopping', name: 'Online Shopping' },
            { id: 'travel', name: 'Travelling' },
            { id: 'cities', name: 'Big Cities' },
            { id: 'english', name: 'Learning English' },
            { id: 'diet', name: 'Healthy Diet' }
        ];

        let currentTopic = 'social';
        let currentMode = 'full';
        let currentSectionIndex = 0;
        let essayData = {};

        const sections = [
            { id: 'intro', name: 'Introduction', wordTarget: '35-40 words' },
            { id: 'claim1', name: 'Claim 1', wordTarget: '50-55 words' },
            { id: 'claim2', name: 'Claim 2', wordTarget: '50-55 words' },
            { id: 'claim3', name: 'Claim 3', wordTarget: '50-55 words' },
            { id: 'conclusion', name: 'Conclusion', wordTarget: '30-35 words' }
        ];

        function init() {
            renderTopics();
            renderComposer();
            updatePreview();
            makeDraggable();
        }

        function renderTopics() {
            document.getElementById('topics').innerHTML = topics.map(t => 
                `<button class="topic-btn ${t.id === currentTopic ? 'active' : ''}" 
                         onclick="selectTopic('${t.id}')">${t.name}</button>`
            ).join('');
        }

        function selectTopic(id) {
            currentTopic = id;
            renderTopics();
            renderComposer();
            updatePreview();
        }

        function setMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const composer = document.getElementById('composer');
            if (mode === 'paragraph') {
                composer.classList.add('paragraph-mode');
                document.querySelectorAll('.section').forEach((s, i) => {
                    s.classList.toggle('active', i === currentSectionIndex);
                });
                updateParaNav();
            } else {
                composer.classList.remove('paragraph-mode');
            }
        }

        function renderComposer() {
            const html = `
                ${renderIntroSection()}
                ${renderClaimSection('claim1', 'Claim 1', 1)}
                ${renderClaimSection('claim2', 'Claim 2', 2)}
                ${renderClaimSection('claim3', 'Claim 3', 3)}
                ${renderConclusionSection()}
            `;
            document.getElementById('composer').innerHTML = html;
        }

        function renderIntroSection() {
            return `
                <div class="section intro ${currentMode === 'paragraph' && currentSectionIndex === 0 ? 'active' : ''}" data-index="0">
                    <div class="section-header">
                        <span class="section-title">üìù Introduction</span>
                        <div>
                            <span class="word-target">35-40 words</span>
                            <button class="guide-btn" onclick="showGuide()">? Guide</button>
                        </div>
                    </div>
                    <div class="dropdowns-row">
                        ${renderDropdownBtn('intro', 'background', 'Background Info')}
                        ${renderDropdownBtn('intro', 'aim', 'Essay Aim')}
                        ${renderIdeasBtn('intro', 'ideas', 'üí° IDEAS')}
                    </div>
                    ${renderDropdownPanel('intro', 'background')}
                    ${renderDropdownPanel('intro', 'aim')}
                    ${renderIdeasPanel('intro')}
                    <textarea class="paragraph-input" placeholder="Write your complete introduction paragraph here..."
                              oninput="handleInput('intro', this.value)">${essayData['intro'] || ''}</textarea>
                </div>
            `;
        }

        function renderClaimSection(id, title, num) {
            const isCounter = num === 3;
            return `
                <div class="section ${isCounter ? 'counter' : ''} ${currentMode === 'paragraph' && currentSectionIndex === num ? 'active' : ''}" data-index="${num}">
                    <div class="section-header">
                        <span class="section-title">üí° ${title}</span>
                        <div>
                            <span class="word-target">50-55 words</span>
                            <button class="guide-btn" onclick="showGuide()">? Guide</button>
                        </div>
                    </div>
                    <div class="dropdowns-row">
                        ${renderDropdownBtn(id, 'listing', 'Listing')}
                        ${renderDropdownBtn(id, 'opinion', 'Opinion')}
                        ${renderDropdownBtn(id, 'claim', 'Claim')}
                        ${renderDropdownBtn(id, 'reason', 'Reason')}
                    </div>
                    <div class="dropdowns-row">
                        ${renderDropdownBtn(id, 'example', 'Example')}
                        ${renderDropdownBtn(id, 'result', 'Result')}
                        ${renderDropdownBtn(id, 'compare', 'Compare')}
                        ${renderDropdownBtn(id, 'contrast', 'Contrast')}
                    </div>
                    <div class="dropdowns-row">
                        ${renderIdeasBtn(id, 'ideas', 'üí° IDEAS')}
                    </div>
                    ${renderDropdownPanel(id, 'listing')}
                    ${renderDropdownPanel(id, 'opinion')}
                    ${renderDropdownPanel(id, 'claim')}
                    ${renderDropdownPanel(id, 'reason')}
                    ${renderDropdownPanel(id, 'example')}
                    ${renderDropdownPanel(id, 'result')}
                    ${renderDropdownPanel(id, 'compare')}
                    ${renderDropdownPanel(id, 'contrast')}
                    ${renderIdeasPanel(id)}
                    <textarea class="paragraph-input" placeholder="Write your complete ${title} paragraph here..."
                              oninput="handleInput('${id}', this.value)">${essayData[id] || ''}</textarea>
                </div>
            `;
        }

        function renderConclusionSection() {
            return `
                <div class="section conclusion ${currentMode === 'paragraph' && currentSectionIndex === 4 ? 'active' : ''}" data-index="4">
                    <div class="section-header">
                        <span class="section-title">üéØ Conclusion</span>
                        <div>
                            <span class="word-target">30-35 words</span>
                            <button class="guide-btn" onclick="showGuide()">? Guide</button>
                        </div>
                    </div>
                    <div class="dropdowns-row">
                        ${renderDropdownBtn('conclusion', 'conclusion', 'Conclusion Phrase')}
                        ${renderDropdownBtn('conclusion', 'opinion', 'Opinion')}
                        ${renderDropdownBtn('conclusion', 'finalThought', 'Final Thought')}
                        ${renderIdeasBtn('conclusion', 'ideas', 'üí° IDEAS')}
                    </div>
                    ${renderDropdownPanel('conclusion', 'conclusion')}
                    ${renderDropdownPanel('conclusion', 'opinion')}
                    ${renderDropdownPanel('conclusion', 'finalThought')}
                    ${renderIdeasPanel('conclusion')}
                    <textarea class="paragraph-input" placeholder="Write your complete conclusion paragraph here..."
                              oninput="handleInput('conclusion', this.value)">${essayData['conclusion'] || ''}</textarea>
                </div>
            `;
        }

        function renderDropdownBtn(section, type, label) {
            const id = `${section}-${type}`;
            return `<button class="dropdown-btn" onclick="toggleDropdown('${id}')">${label} ‚ñº</button>`;
        }

        function renderIdeasBtn(section, type, label) {
            const id = `${section}-${type}`;
            return `<button class="dropdown-btn ideas-btn" onclick="toggleDropdown('${id}')">${label}</button>`;
        }

        function renderDropdownPanel(section, type) {
            const id = `${section}-${type}`;
            const phrases = phraseBank[type];
            if (!phrases) return '';
            
            return `
                <div class="dropdown-panel" id="panel-${id}">
                    <div class="level natural">
                        <div class="level-header">‚ùå NATURAL (A2-B1) - Avoid</div>
                        <div class="level-content">
                            ${phrases.natural.map(p => `<div class="phrase-item">${p}</div>`).join('')}
                        </div>
                        <div class="level-why">Too casual for academic writing</div>
                    </div>
                    <div class="level intermediate">
                        <div class="level-header">‚ö†Ô∏è B2 - Acceptable</div>
                        <div class="level-content">
                            ${phrases.intermediate.map(p => `<div class="phrase-item">${p}</div>`).join('')}
                        </div>
                        <div class="level-why">More formal - suitable for B2 level</div>
                    </div>
                    <div class="level academic">
                        <div class="level-header">‚úÖ C1 - TARGET LEVEL</div>
                        <div class="level-content">
                            ${phrases.academic.map(p => `<div class="phrase-item">${p}</div>`).join('')}
                        </div>
                        <div class="level-why">Sophisticated vocabulary and scholarly tone</div>
                    </div>
                </div>
            `;
        }

        function renderIdeasPanel(section) {
            const id = `${section}-ideas`;
            const ideas = topicIdeas[currentTopic][section];
            
            if (!ideas) return '';
            
            let content = '';
            
            if (section === 'intro') {
                content = `
                    <div class="idea-section">
                        <div class="idea-label">Main Idea</div>
                        <div class="idea-text">${ideas.mainIdea}</div>
                    </div>
                    <div class="idea-section">
                        <div class="idea-label">Supporting Points</div>
                        <ul class="idea-list">
                            ${ideas.points.map(p => `<li>${p}</li>`).join('')}
                        </ul>
                    </div>
                `;
            } else if (section.startsWith('claim')) {
                content = `
                    <div class="idea-section">
                        <div class="idea-label">Main Argument</div>
                        <div class="idea-text">${ideas.mainArgument}</div>
                    </div>
                    <div class="idea-section">
                        <div class="idea-label">Reason Why</div>
                        <div class="idea-text">${ideas.reason}</div>
                    </div>
                    <div class="idea-section">
                        <div class="idea-label">Example to Use</div>
                        <div class="idea-text">${ideas.example}</div>
                    </div>
                    <div class="idea-section">
                        <div class="idea-label">${ideas.contrast ? 'Contrast/Mitigation' : 'Result/Impact'}</div>
                        <div class="idea-text">${ideas.contrast || ideas.result}</div>
                    </div>
                `;
            } else if (section === 'conclusion') {
                content = `
                    <div class="idea-section">
                        <div class="idea-label">Summary</div>
                        <div class="idea-text">${ideas.summary}</div>
                    </div>
                    <div class="idea-section">
                        <div class="idea-label">Final View</div>
                        <div class="idea-text">${ideas.finalView}</div>
                    </div>
                `;
            }
            
            return `
                <div class="dropdown-panel ideas-panel" id="panel-${id}">
                    <div class="ideas-content">
                        ${content}
                    </div>
                </div>
            `;
        }

        function toggleDropdown(id) {
            const panel = document.getElementById('panel-' + id);
            const btn = event.target;
            const wasActive = panel.classList.contains('active');
            
            document.querySelectorAll('.dropdown-panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.dropdown-btn').forEach(b => b.classList.remove('active'));
            
            if (!wasActive) {
                panel.classList.add('active');
                btn.classList.add('active');
            }
        }

        function handleInput(section, value) {
            essayData[section] = value;
            event.target.classList.add('saved');
            setTimeout(() => event.target.classList.remove('saved'), 500);
            updatePreview();
        }

        function updatePreview() {
            const preview = document.getElementById('previewBody');
            let html = '';
            
            sections.forEach(s => {
                if (essayData[s.id]) {
                    html += `
                        <div class="preview-paragraph">
                            <div class="preview-section-label">${s.name.toUpperCase()}</div>
                            ${essayData[s.id]}
                        </div>
                    `;
                }
            });
            
            if (html === '') {
                html = '<div class="preview-empty">Start writing to see your essay build here...</div>';
            }
            
            preview.innerHTML = html + `
                <div class="register-section">
                    <div class="register-title">üéØ REGISTER ANALYSIS</div>
                    <div class="meter-bar">
                        <div class="meter-fill" style="width: ${calculateRegister()}%"></div>
                    </div>
                    <div class="word-count-display ${getWordCountClass()}">${getWordCountText()}</div>
                </div>
            `;
        }

        function calculateRegister() {
            const allText = Object.values(essayData).join(' ').toLowerCase();
            if (!allText.trim()) return 0;
            
            const academicWords = ['systematically', 'facilitate', 'comprehensive', 'demonstrate', 'consequently', 'notwithstanding', 'moreover'];
            let score = 0;
            academicWords.forEach(word => {
                if (allText.includes(word)) score += 15;
            });
            return Math.min(score, 100);
        }

        function getWordCountText() {
            const allText = Object.values(essayData).join(' ');
            const words = allText.trim().split(/\s+/).filter(w => w.length > 0).length;
            return `Words: ${words} / 190 target`;
        }

        function getWordCountClass() {
            const allText = Object.values(essayData).join(' ');
            const words = allText.trim().split(/\s+/).filter(w => w.length > 0).length;
            if (words >= 180 && words <= 200) return '';
            if (words < 180) return 'warning';
            return 'error';
        }

        function navigateSection(dir) {
            currentSectionIndex = Math.max(0, Math.min(4, currentSectionIndex + dir));
            document.querySelectorAll('.section').forEach((s, i) => {
                s.classList.toggle('active', i === currentSectionIndex);
            });
            updateParaNav();
        }

        function updateParaNav() {
            document.getElementById('paraIndicator').textContent = 
                `${sections[currentSectionIndex].name} (${currentSectionIndex + 1}/5)`;
            document.getElementById('prevBtn').disabled = currentSectionIndex === 0;
            document.getElementById('nextBtn').disabled = currentSectionIndex === 4;
        }

        function showGuide() {
            document.getElementById('guideOverlay').classList.add('active');
        }

        function closeGuide() {
            document.getElementById('guideOverlay').classList.remove('active');
        }

        function saveDraft() {
            const data = JSON.stringify({ topic: currentTopic, data: essayData }, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `essay_draft_${currentTopic}_${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            alert('‚úÖ Draft saved!');
        }

        function loadDraft() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const draft = JSON.parse(event.target.result);
                        currentTopic = draft.topic;
                        essayData = draft.data;
                        renderTopics();
                        renderComposer();
                        updatePreview();
                        alert('‚úÖ Draft loaded!');
                    } catch (err) {
                        alert('‚ùå Error loading draft');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function resetAll() {
            if (confirm('‚ö†Ô∏è Reset all content? This cannot be undone.')) {
                essayData = {};
                renderComposer();
                updatePreview();
            }
        }

        function exportEssay() {
            let text = `${topics.find(t => t.id === currentTopic).name.toUpperCase()} - ESSAY\n`;
            text += `Generated: ${new Date().toLocaleDateString()}\n${'='.repeat(50)}\n\n`;
            
            sections.forEach(s => {
                if (essayData[s.id]) {
                    text += essayData[s.id] + '\n\n';
                }
            });
            
            const allText = Object.values(essayData).join(' ');
            const words = allText.trim().split(/\s+/).filter(w => w.length > 0).length;
            text += `\n${'='.repeat(50)}\nWord Count: ${words}\nTarget: 190 words\n`;
            
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `essay_${currentTopic}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            alert('‚úÖ Essay exported!');
        }

        function makeDraggable() {
            const popup = document.getElementById('previewPopup');
            const header = document.getElementById('previewHeader');
            let isDragging = false;
            let currentX, currentY, initialX, initialY;

            header.addEventListener('mousedown', dragStart);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', dragEnd);

            function dragStart(e) {
                initialX = e.clientX - popup.offsetLeft;
                initialY = e.clientY - popup.offsetTop;
                isDragging = true;
            }

            function drag(e) {
                if (isDragging) {
                    e.preventDefault();
                    currentX = e.clientX - initialX;
                    currentY = e.clientY - initialY;
                    popup.style.left = currentX + 'px';
                    popup.style.top = currentY + 'px';
                    popup.style.right = 'auto';
                }
            }

            function dragEnd() {
                isDragging = false;
            }
        }

        init();
    </script>
</body>
</html>
